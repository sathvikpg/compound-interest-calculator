<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-adsense-account" content="ca-pub-7001027300884558">

    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7001027300884558"
        crossorigin="anonymous"></script>
    <title>Compound Interest Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Favicon Link - Updated with British Racing Green arrow -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg width='120' height='120' viewBox='0 0 120 120' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M30 90 L90 30 M90 30 L65 30 M90 30 L90 55' stroke='%23004225' stroke-width='12' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E">
    <!-- You can also use a PNG or ICO file if you save the SVG as one: -->
    <!-- <link rel="icon" type="image/png" href="/path/to/your/logo.png"> -->
    <!-- <link rel="icon" type="image/x-icon" href="/path/to/your/favicon.ico"> -->

    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .calculator-container {
            max-width: 700px;
            margin: 2rem auto;
            padding: 2rem;
            background-color: #ffffff;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .input-group {
            margin-bottom: 1.5rem;
        }
        .input-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #374151;
        }
        .input-field, .select-field {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #D1D5DB;
            border-radius: 0.375rem;
            box-shadow: inset 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
            background-color: white;
        }
        .input-field:focus, .select-field:focus {
            outline: none;
            border-color: #6366F1;
            box-shadow: 0 0 0 0.2rem rgba(99, 102, 241, 0.25);
        }
        .main-button-container {
            display: flex;
            gap: 0.75rem;
            margin-top: 1.5rem;
        }
        .calculate-button, .reset-button {
            flex-grow: 1;
            padding: 0.75rem 1rem;
            color: white;
            font-weight: 600;
            border-radius: 0.375rem;
            transition: background-color 0.15s ease-in-out;
            cursor: pointer;
            font-size: 0.875rem;
            text-align: center;
        }
        .calculate-button {
            background-color: #6366F1;
        }
        .calculate-button:hover {
            background-color: #4F46E5;
        }
        .reset-button {
            background-color: #6B7280;
        }
        .reset-button:hover {
            background-color: #4B5563;
        }

        .toggle-breakdown-button {
            width: 100%;
            margin-top: 1rem;
            padding: 0.75rem 1rem;
            color: white;
            font-weight: 600;
            border-radius: 0.375rem;
            transition: background-color 0.15s ease-in-out;
            cursor: pointer;
            font-size: 0.875rem;
            text-align: center;
            background-color: #F59E0B;
            display: none;
        }
        .toggle-breakdown-button:hover {
            background-color: #D97706;
        }

        .results-container {
            margin-top: 2rem;
            padding: 1.5rem;
            background-color: #F3F4F6;
            border-radius: 0.375rem;
        }
        .result-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.75rem;
            font-size: 1rem;
        }
        .result-label {
            font-weight: 500;
            color: #4B5563;
        }
        .result-value {
            font-weight: 600;
            color: #1F2937;
        }
        /* Updated color classes for consistency */
        .result-value.positive {
            color: #004225; /* Dark Green */
        }
        .result-value.negative {
            color: #DC2626; /* Red, same as withdrawal button */
        }
        .result-value.light-positive {
            color: #004225; /* Dark Green, same as positive */
        }
        .result-value.light-negative {
            color: #DC2626; /* Red, same as negative */
        }

        .message-box {
            margin-top: 1rem; padding: 0.75rem 1rem; border-radius: 0.375rem;
            font-size: 0.875rem; text-align: center;
        }
        .message-box-error { background-color: #FEE2E2; color: #B91C1C; border: 1px solid #FCA5A5; }
        .message-box-success { background-color: #D1FAE5; color: #065F46; border: 1px solid #6EE7B7; }

        .contribution-tabs { display: flex; gap: 0.5rem; margin-bottom: 1rem; }
        .contribution-tabs input[type="radio"] { display: none; }
        .contribution-tabs label {
            flex-grow: 1; text-align: center; padding: 0.625rem 0.5rem; font-size: 0.875rem;
            font-weight: 500; color: #4B5563; background-color: #F3F4F6;
            border: 1px solid #D1D5DB; border-radius: 0.375rem; cursor: pointer;
            transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out, border-color 0.2s ease-in-out;
            white-space: nowrap;
        }
        .contribution-tabs label:hover { background-color: #E5E7EB; }
        .contribution-tabs input[type="radio"]:checked + label { background-color: #6366F1; color: white; border-color: #4F46E5; }
        .contribution-tabs input[type="radio"]#contribDeposits:checked + label { background-color: #16A34A; color: white; border-color: #15803D; }
        .contribution-tabs input[type="radio"]#contribWithdrawals:checked + label { background-color: #DC2626; color: white; border-color: #B91C1C; }

        .optional-fields-section { margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid #E5E7EB;}
        .optional-fields-section h3 { font-size: 1.125rem; font-weight: 600; color: #374151; margin-bottom: 1rem; }
        .grid-2-col { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1rem; }

        .breakdown-section {
            margin-top: 2rem;
            padding: 1.5rem;
            background-color: #F9FAFB;
            border: 1px solid #E5E7EB;
            border-radius: 0.375rem;
        }
        .breakdown-controls {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            justify-content: center;
        }
        .breakdown-controls button {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            font-weight: 500;
            border-radius: 0.375rem;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
            background-color: #E5E7EB;
            color: #374151;
            border: 1px solid #D1D5DB;
        }
        .breakdown-controls button.active {
            background-color: #4F46E5;
            color: white;
            border-color: #4338CA;
        }
        .breakdown-table-container {
            max-height: 400px;
            overflow-y: auto;
        }
        .breakdown-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.875rem;
        }
        .breakdown-table th, .breakdown-table td {
            border: 1px solid #D1D5DB;
            padding: 0.5rem;
            text-align: right;
        }
        .breakdown-table th {
            background-color: #E5E7EB;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .breakdown-table td {
            font-weight: 500;
        }
        .breakdown-table td:first-child, .breakdown-table th:first-child {
            text-align: left;
        }
        .breakdown-table td.positive {
            color: #004225;
        }
        .breakdown-table td.negative {
            color: #DC2626;
        }
        .breakdown-table tr.last-row-highlight td {
            background-color: #E0E7FF;
        }

        /* Sidebar Styles */
        .hamburger-icon {
            position: fixed;
            top: 20px;
            right: 20px;
            font-size: 30px;
            cursor: pointer;
            z-index: 1001; /* Above sidebar */
            color: #374151;
            background-color: #ffffff;
            padding: 5px 10px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .sidebar {
            height: 100%;
            width: 0; /* Hidden by default */
            position: fixed;
            z-index: 1000;
            top: 0;
            right: 0;
            background-color: #374151;
            overflow-x: hidden;
            transition: 0.5s; /* Smooth transition */
            padding-top: 60px;
            box-shadow: -5px 0 15px rgba(0,0,0,0.2);
        }

        .sidebar.open {
            width: 280px; /* Open width */
        }

        .sidebar .close-btn {
            position: absolute;
            top: 15px;
            right: 25px;
            font-size: 36px;
            margin-left: 50px;
            color: #9CA3AF;
            cursor: pointer;
        }

        .sidebar ul {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }

        .sidebar ul li {
            padding: 15px 25px;
            text-decoration: none;
            font-size: 1.1rem;
            color: #F9FAFB;
            display: block;
            transition: 0.3s;
            cursor: pointer;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .sidebar ul li:hover {
            background-color: #4B5563;
        }

        /* Educational Content Section */
        .educational-content {
            max-width: 800px;
            margin: 3rem auto;
            padding: 2rem;
            background-color: #ffffff;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        .content-section {
            display: none; /* Hidden by default */
            padding: 1.5rem 0;
            border-bottom: 1px solid #E5E7EB;
        }
        .content-section:last-child {
            border-bottom: none;
        }

        .content-section h2 {
            font-size: 1.75rem;
            font-weight: 700;
            color: #1F2937;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #6366F1;
        }
        .content-section h3 { /* For subheadings like "Scenario Illustration" */
            font-size: 1.3rem;
            font-weight: 600;
            color: #374151;
            margin-top: 1.5rem;
            margin-bottom: 0.8rem;
        }

        .content-section p {
            margin-bottom: 1rem;
            line-height: 1.6;
            color: #4B5563;
        }

        .content-section ul {
            list-style-type: disc;
            margin-left: 20px;
            margin-bottom: 1rem;
            color: #4B5563;
        }
        .content-section ul li {
            margin-bottom: 0.5rem;
            line-height: 1.5;
        }
        .content-section strong {
            color: #1F2937;
        }
        .content-section pre {
            background-color: #F3F4F6;
            padding: 1rem;
            border-radius: 0.375rem;
            overflow-x: auto;
            margin-top: 1rem;
            margin-bottom: 1rem;
            color: #1F2937;
        }
    </style>
</head>
<body class="bg-gray-100">

    <div class="hamburger-icon" id="hamburgerIcon">
        &#9776; </div>

    <div id="sidebar" class="sidebar">
        <span class="close-btn" id="closeBtn">&times;</span>
        <ul>
            <li data-target="whatIsCompoundInterest">What is Compound Interest?</li>
            <li data-target="howDoesCompoundInterestWork">How Does Compound Interest Work?</li>
            <li data-target="powerOfCompounding">The Power of Compounding: Why Start Early?</li>
            <li data-target="typesOfCompoundingFrequencies">Types of Compounding Frequencies and Their Impact</li>
            <li data-target="compoundVsSimpleInterest">Compound Interest vs. Simple Interest</li>
            <li data-target="savingForRetirement">Saving for Retirement with Compound Interest</li>
            <li data-target="investingStrategies">Investing Strategies Leveraging Compounding</li>
            <li data-target="inflationAndRealReturns">Understanding Inflation and Real Returns</li>
            <li data-target="faqs">FAQs about Compound Interest</li>
        </ul>
    </div>

    <div class="calculator-container">
        <h1 class="text-2xl font-bold text-center text-gray-800 mb-8">Compound Interest Calculator</h1>

        <div class="input-group">
            <label for="currency" class="input-label">Currency</label>
            <select id="currency" class="select-field">
                <option value="$" data-label="USD ($)">US Dollar ($)</option>
                <option value="€" data-label="EUR (€)">Euro (€)</option>
                <option value="¥" data-label="JPY (¥)">Japanese Yen (¥)</option>
                <option value="£" data-label="GBP (£)">British Pound (£)</option>
                <option value="A$" data-label="AUD (A$)">Australian Dollar (A$)</option>
                <option value="C$" data-label="CAD (C$)">Canadian Dollar (C$)</option>
                <option value="Fr" data-label="CHF (Fr)">Swiss Franc (Fr)</option>
                <option value="₹" data-label="INR (₹)" selected>Indian Rupee (₹)</option>
                <option value="R$" data-label="BRL (R$)">Brazilian Real (R$)</option>
                <option value="₽" data-label="RUB (₽)">Russian Ruble (₽)</option>
                <option value="元" data-label="CNY (元)">Chinese Yuan (元)</option>
                <option value="₩" data-label="KRW (₩)">South Korean Won (₩)</option>
            </select>
        </div>

        <div class="input-group">
            <label for="principal" class="input-label">Principal Amount (<span id="principalCurrencyLabel">₹</span>)</label>
            <input type="number" id="principal" class="input-field" placeholder="e.g., 10000">
        </div>

        <div class="input-group">
            <label for="rate" class="input-label">Annual Interest Rate (%)</label>
            <input type="number" id="rate" class="input-field" placeholder="e.g., 5">
        </div>

        <div class="input-group">
            <label for="frequency" class="input-label">Main Compounding Frequency</label>
            <select id="frequency" class="select-field">
                <option value="365">Daily</option>
                <option value="52">Weekly</option>
                <option value="12" selected>Monthly</option>
                <option value="4">Quarterly</option>
                <option value="2">Semi-Annually</option>
                <option value="1">Annually</option>
            </select>
        </div>

        <div class="input-group">
            <label for="time" class="input-label">Time Period (Years)</label>
            <input type="number" id="time" class="input-field" placeholder="e.g., 10">
        </div>

        <div class="input-group">
            <label class="input-label">Additional Contributions/Withdrawals</label>
            <div class="contribution-tabs" id="contributionTabs">
                <input type="radio" name="contributionType" value="none" id="contribNone" checked>
                <label for="contribNone">None</label>

                <input type="radio" name="contributionType" value="deposits" id="contribDeposits">
                <label for="contribDeposits">Deposits Only</label>

                <input type="radio" name="contributionType" value="withdrawals" id="contribWithdrawals">
                <label for="contribWithdrawals">Withdrawals Only</label>

                <input type="radio" name="contributionType" value="both" id="contribBoth">
                <label for="contribBoth">Both</label>
            </div>
        </div>

        <div id="depositFieldsSection" class="optional-fields-section" style="display: none;">
            <h3>Periodic Deposits</h3>
            <div class="grid-2-col">
                <div class="input-group">
                    <label for="depositAmount" class="input-label">Deposit Amount</label>
                    <input type="number" id="depositAmount" class="input-field" placeholder="e.g., 100">
                </div>
                <div class="input-group">
                    <label for="depositFrequency" class="input-label">Deposit Frequency</label>
                    <select id="depositFrequency" class="select-field">
                        <option value="365">Daily</option>
                        <option value="52">Weekly</option>
                        <option value="12" selected>Monthly</option>
                        <option value="4">Quarterly</option>
                        <option value="2">Semi-Annually</option>
                        <option value="1">Annually</option>
                    </select>
                </div>
            </div>
            <div class="input-group">
                <label for="annualDepositIncrease" class="input-label">Annual Deposit Increase (%) (Optional)</label>
                <input type="number" id="annualDepositIncrease" class="input-field" placeholder="e.g., 2">
            </div>
        </div>

        <div id="withdrawalFieldsSection" class="optional-fields-section" style="display: none;">
            <h3>Periodic Withdrawals</h3>
            <div class="grid-2-col">
                <div class="input-group">
                    <label for="withdrawalAmount" class="input-label">Withdrawal Amount</label>
                    <input type="number" id="withdrawalAmount" class="input-field" placeholder="e.g., 50">
                </div>
                <div class="input-group">
                    <label for="withdrawalFrequency" class="input-label">Withdrawal Frequency</label>
                    <select id="withdrawalFrequency" class="select-field">
                        <option value="365">Daily</option>
                        <option value="52">Weekly</option>
                        <option value="12" selected>Monthly</option>
                        <option value="4">Quarterly</option>
                        <option value="2">Semi-Annually</option>
                        <option value="1">Annually</option>
                    </select>
                </div>
            </div>
            <div class="input-group">
                <label for="annualWithdrawalIncrease" class="input-label">Annual Withdrawal Increase (%) (Optional)</label>
                <input type="number" id="annualWithdrawalIncrease" class="input-field" placeholder="e.g., 1">
            </div>
        </div>

        <div class="main-button-container">
            <button id="calculateBtn" class="calculate-button">Calculate</button>
            <button id="resetBtn" class="reset-button">Reset</button>
        </div>


        <div id="messageBox" class="message-box" style="display: none;"></div>

        <div id="results" class="results-container" style="display: none;">
            <h2 class="text-xl font-semibold text-gray-700 mb-4 text-center">Results</h2>
            <div class="result-item">
                <span class="result-label">Principal Amount:</span>
                <span id="resultPrincipal" class="result-value"></span>
            </div>
            <div id="resultTotalDepositsRow" class="result-item" style="display: none;">
                <span class="result-label">Total Deposits Made:</span>
                <span id="resultTotalDeposits" class="result-value"></span>
            </div>
            <div id="resultTotalWithdrawalsRow" class="result-item" style="display: none;">
                <span class="result-label">Total Withdrawals Made:</span>
                <span id="resultTotalWithdrawals" class="result-value"></span>
            </div>
            <div class="result-item">
                <span id="resultInterestLabel" class="result-label">Total Interest Earned:</span>
                <span id="resultInterest" class="result-value"></span>
            </div>
            <hr class="my-2 border-gray-300">
            <div class="result-item">
                <span class="result-label text-lg">Future Value:</span>
                <span id="resultTotal" class="result-value text-lg"></span>
            </div>
            <button id="toggleBreakdownBtn" class="toggle-breakdown-button">Show Breakdown</button>
        </div>

        <div id="breakdownSection" class="breakdown-section" style="display: none;">
            <h3 class="text-xl font-semibold text-gray-700 mb-4 text-center">Calculation Breakdown</h3>
            <div class="breakdown-controls">
                <button id="viewMonthlyBreakdownBtn" class="active">View Monthly</button>
                <button id="viewYearlyBreakdownBtn">View Yearly</button>
            </div>
            <div class="breakdown-table-container">
                <table id="breakdownTable" class="breakdown-table">
                    <thead>
                        <tr>
                            <th>Period</th>
                            <th>Start Balance</th>
                            <th>Deposits</th>
                            <th>Withdrawals</th>
                            <th>Interest</th>
                            <th>End Balance</th>
                        </tr>
                    </thead>
                    <tbody id="breakdownTableBody"></tbody>
                </table>
            </div>
        </div>

    </div>

    <div id="educationalContent" class="educational-content">
        <div id="whatIsCompoundInterest" class="content-section">
            <h2>What is Compound Interest?</h2>
            <p>Compound interest is essentially "interest on interest." Instead of just earning interest on your initial principal amount, you also earn interest on the accumulated interest from previous periods. Think of it like a snowball rolling downhill: as it picks up more snow (interest), it gets bigger, and therefore picks up even more snow faster. This accelerating growth is what makes compound interest so powerful. It's a fundamental concept in finance and investing, allowing your money to grow exponentially over time.</p>
        </div>

        <div id="howDoesCompoundInterestWork" class="content-section">
            <h2>How Does Compound Interest Work?</h2>
            <p>The magic of compound interest lies in its formula. Let's break it down:</p>
            <pre>A = P(1 + r/n)<sup>nt</sup></pre>
            <p>Where:</p>
            <ul>
                <li>A = the future value of the investment/loan, including interest</li>
                <li>P = the principal investment amount (the initial deposit or loan amount)</li>
                <li>r = the annual interest rate (as a decimal)</li>
                <li>n = the number of times that interest is compounded per year</li>
                <li>t = the number of years the money is invested or borrowed for</li>
            </ul>
            <h3>Let's illustrate with an example:</h3>
            <p>Imagine you invest ₹10,000 at an annual interest rate of 5%, compounded annually for 3 years.</p>
            <ul>
                <li><strong>Year 1:</strong></li>
                <ul>
                    <li>Interest earned: ₹10,000 * 0.05 = ₹500</li>
                    <li>New balance: ₹10,000 + ₹500 = ₹10,500</li>
                </ul>
                <li><strong>Year 2:</strong></li>
                <ul>
                    <li>Interest earned: ₹10,500 * 0.05 = ₹525 (Notice it's more than Year 1 because you're earning interest on the ₹500 earned in Year 1)</li>
                    <li>New balance: ₹10,500 + ₹525 = ₹11,025</li>
                </ul>
                <li><strong>Year 3:</strong></li>
                <ul>
                    <li>Interest earned: ₹11,025 * 0.05 = ₹551.25</li>
                    <li>New balance: ₹11,025 + ₹551.25 = ₹11,576.25</li>
                </ul>
            </ul>
            <p>Using the formula: $A = 10000(1+0.05/1)^{1*3} = 10000(1.05)^3 = 10000 * 1.157625 = ₹11,576.25$</p>
            <p>As you can see, the interest earned in each subsequent year is higher because the base on which the interest is calculated (your principal plus accumulated interest) grows.</p>
        </div>

        <div id="powerOfCompounding" class="content-section">
            <h2>The Power of Compounding: Why Start Early?</h2>
            <p>The earlier you start investing, the more time compound interest has to work its magic. Even small, consistent contributions can grow into substantial sums over decades. This is due to the exponential nature of compounding.</p>
            <h3>Scenario Illustration:</h3>
            <p>Consider two individuals, Anil and Bala, both investing ₹5,000 per month at an annual interest rate: 8%.</p>
            <ul>
                <li><strong>Anil:</strong> Starts investing at age 25 and continues until age 60 (35 years).</li>
                <li><strong>Bala:</strong> Starts investing at age 35 and continues until age 60 (25 years).</li>
            </ul>
            <p>While both invest the same monthly amount, Anil's money has an extra 10 years to compound. The difference in their final accumulated wealth would be significant, with Anil potentially accumulating significantly more than Bala, even though Bala invested for a shorter period. This highlights the crucial role of time in maximizing compound returns.</p>
        </div>

        <div id="typesOfCompoundingFrequencies" class="content-section">
            <h2>Types of Compounding Frequencies and Their Impact</h2>
            <p>The frequency of compounding refers to how often the earned interest is added back to the principal. The more frequently interest is compounded, the faster your money grows, as you start earning interest on your interest sooner.</p>
            <p>Common compounding frequencies include:</p>
            <ul>
                <li><strong>Annually (n=1):</b> Interest is calculated and added once a year.</li>
                <li><strong>Semi-annually (n=2):</strong> Interest is calculated and added twice a year.</li>
                <li><strong>Quarterly (n=4):</b> Interest is calculated and added four times a year.</li>
                <li><strong>Monthly (n=12):</strong> Interest is calculated and added twelve times a year.</li>
                <li><strong>Daily (n=365):</strong> Interest is calculated and added every day.</li>
            </ul>
            <h3>Impact on Returns:</h3>
            <p>Let's use our ₹10,000 example at 5% for 3 years:</p>
            <ul>
                <li><strong>Annually:</strong> ₹11,576.25</li>
                <li><strong>Semi-annually:</strong> $A = 10000(1+0.05/2)^{2*3} = 10000(1.025)^6 = ₹11,596.93$</li>
                <li><strong>Monthly:</strong> $A = 10000(1+0.05/12)^{12*3} = 10000(1.0041666)^{36} = ₹11,614.72$</li>
                <li><strong>Daily:</b> $A = 10000(1+0.05/365)^{365*3} = 10000(1.0001369)^{1095} = ₹11,618.34$</li>
            </ul>
            <p>As you can see, the more frequent the compounding, the slightly higher the final return. While the difference might seem small in short periods, it becomes more significant over longer investment horizons.</p>
        </div>

        <div id="compoundVsSimpleInterest" class="content-section">
            <h2>Compound Interest vs. Simple Interest</h2>
            <p>The key distinction between compound interest and simple interest lies in how interest is calculated.</p>
            <ul>
                <li><strong>Simple Interest:</strong> Interest is calculated only on the initial principal amount. The interest earned is not added back to the principal to earn further interest. It's a linear growth.</li>
                <ul>
                    <li>Formula: Simple Interest (SI) = P * r * t</li>
                </ul>
                <li><strong>Compound Interest:</strong> Interest is calculated on the initial principal and on the accumulated interest from previous periods. This leads to exponential growth.</li>
            </ul>
            <h3>Comparison Example (₹10,000 at 5% for 3 years):</h3>
            <ul>
                <li><strong>Simple Interest:</strong></li>
                <ul>
                    <li>Year 1 Interest: ₹500</li>
                    <li>Year 2 Interest: ₹500</li>
                    <li>Year 3 Interest: ₹500</li>
                    <li>Total Interest: ₹1,500</li>
                    <li>Final Balance: ₹11,500</li>
                </ul>
                <li><strong>Compound Interest (Annually):</strong></li>
                <ul>
                    <li>Final Balance: ₹11,576.25 (as calculated above)</li>
                </ul>
            </ul>
            <p>The difference of ₹76.25 (₹11,576.25 - ₹11,500) might appear small in this short example, but over longer periods and with larger sums, the compounding effect makes a substantial difference in favor of compound interest.</p>
        </div>

        <div id="savingForRetirement" class="content-section">
            <h2>Saving for Retirement with Compound Interest</h2>
            <p>Saving for retirement is one of the most crucial applications of compound interest. Here's practical advice:</p>
            <ul>
                <li><strong>Start Early:</strong> As discussed, time is your biggest asset with compounding. Begin contributing to your retirement savings as soon as possible, even if it's a small amount.</li>
                <li><strong>Be Consistent:</strong> Regular contributions, even modest ones, add up significantly over time. Automate your savings to ensure you contribute consistently.</li>
                <li><strong>Maximize Contributions:</strong> Aim to contribute as much as you can afford, especially if your employer offers matching contributions (e.g., in a Provident Fund or NPS in India). This is essentially free money!</li>
                <li><strong>Choose Growth-Oriented Investments:</strong> For long-term retirement goals, consider investments that offer higher potential for compounded returns, such as equity mutual funds.</li>
                <li><strong>Reinvest Dividends/Interest:</strong> If your investments generate dividends or interest, reinvest them back into the same investment to further accelerate compounding.</li>
                <li><strong>Regularly Review and Adjust:</strong> Periodically review your retirement plan and adjust your contributions or investment strategy based on your financial situation and market conditions.</li>
            </ul>
            <h3>Example:</h3>
            <p>A 30-year-old in India starts investing ₹15,000 per month in an equity mutual fund, expecting an average annual return of 10%. By the time they turn 60 (30 years of investing), their total contributions would be ₹54 lakhs (₹15,000 * 12 months * 30 years). However, due to the power of compounding, their investment could grow to approximately ₹3.42 crores!</p>
        </div>

        <div id="investingStrategies" class="content-section">
            <h2>Investing Strategies Leveraging Compounding</h2>
            <p>Compounding is a core principle behind various investment vehicles. Here are some where it plays a significant role:</p>
            <ul>
                <li><strong>Equity Mutual Funds/Stocks:</strong> When you invest in equities, your returns come from capital appreciation (the stock price increasing) and dividends. Reinvesting dividends allows them to buy more shares, which then generate more dividends, leading to compounding growth. Mutual funds pool money from many investors and invest in a diversified portfolio of stocks, and their returns also compound over time.</li>
                <li><strong>Fixed Deposits (FDs) / Recurring Deposits (RDs):</strong> While offering lower returns than equities, FDs and RDs allow you to earn compound interest. If you choose the reinvestment option, the interest earned is added to the principal, and subsequent interest is calculated on this larger amount.</li>
                <li><strong>Public Provident Fund (PPF):</strong> In India, PPF is a government-backed, tax-exempt savings scheme that offers compound interest. The interest is calculated annually and added to your balance, making it a powerful long-term savings tool.</li>
                <li><strong>Bonds:</strong> Some bonds pay interest semi-annually or annually. If you reinvest this interest, you're leveraging compounding.</li>
                <li><strong>Savings Accounts:</strong> Most savings accounts offer compound interest, though usually at a very low rate, often compounded daily or monthly. While not a high-growth investment, the principle of compounding still applies.</li>
            </ul>
            <p><strong>Key Strategy:</strong> The common thread among these is the concept of <strong>reinvestment</strong>. To truly leverage compounding, always strive to reinvest any earnings back into your investment.</p>
        </div>

        <div id="inflationAndRealReturns" class="content-section">
            <h2>Understanding Inflation and Real Returns</h2>
            <p>While compound interest helps your money grow, inflation can erode its purchasing power. Inflation is the rate at which the general level of prices for goods and services is rising, and consequently, the purchasing power of currency is falling.</p>
            <ul>
                <li><strong>Nominal Return:</strong> The stated return on your investment <em>before</em> accounting for inflation. This is what your compound interest calculator will show.</li>
                <li><strong>Real Return:</strong> The return on your investment <em>after</em> accounting for inflation. This indicates the actual increase in your purchasing power.</li>
            </ul>
            <h3>Formula for Real Return (approximately):</h3>
            <pre>Real Return ≈ Nominal Return - Inflation Rate</pre>
            <h3>Example:</h3>
            <p>If your investment earns a nominal return of 8% per year, and the inflation rate is 5% per year, your real return is approximately 3% (8% - 5%). This means your money's purchasing power has increased by 3%, not 8%.</p>
            <p>It's crucial to consider inflation when making long-term investment plans. To maintain or increase your purchasing power over time, your compounded returns must outpace the inflation rate. This is why investing in assets that historically offer returns higher than inflation (like equities) is important for long-term wealth creation.</p>
        </div>

        <div id="faqs" class="content-section">
            <h2>FAQs about Compound Interest</h2>
            <dl>
                <dt><strong>Q1: What is the main difference between simple interest and compound interest?</strong></dt>
                <dd>A1: Simple interest is calculated only on the initial principal, while compound interest is calculated on the principal plus any accumulated interest. This means compound interest grows your money much faster over time.</dd>

                <dt><strong>Q2: Why is "starting early" so important for compound interest?</strong></dt>
                <dd>A2: Time is a critical factor for compounding. The longer your money has to grow, the more cycles of "interest on interest" it goes through, leading to exponential growth. Even small amounts invested early can become substantial.</dd>

                <dt><strong>Q3: Does compounding frequency matter?</strong></dt>
                <dd>A3: Yes, it does. The more frequently interest is compounded (e.g., daily vs. annually), the slightly higher your returns will be because your interest starts earning interest sooner.</dd>

                <dt><strong>Q4: How can I maximize the power of compound interest?</strong></dt>
                <dd>A4: Start investing early, contribute consistently, invest in growth-oriented assets, and always reinvest any dividends or interest earned.</dd>

                <dt><strong>Q5: What is the "Rule of 72"?</strong></dt>
                <dd>A5: The Rule of 72 is a quick and easy way to estimate how long it will take for an investment to double in value, given a fixed annual rate of return. You divide 72 by the annual interest rate. For example, at an 8% annual return, your money would roughly double in 9 years (72 / 8 = 9).</dd>

                <dt><strong>Q6: Does inflation affect my compounded returns?</strong></dt>
                <dd>A6: Yes, inflation erodes the purchasing power of your money. Your "real return" (what your money can actually buy) is your nominal return minus the inflation rate. It's important for your investments to grow faster than inflation to truly increase your wealth.</dd>

                <dt><strong>Q7: Can compound interest work against me?</strong></dt>
                <dd>A7: Yes, if you're on the borrowing side. Loans, especially credit card debt, often compound interest, meaning you pay interest on your outstanding principal and on the interest that has already accrued. This is why high-interest debt can quickly spiral out of control.</dd>

                <dt><strong>Q8: What types of investments commonly use compound interest?</strong></dt>
                <dd>A8: Savings accounts, fixed deposits, recurring deposits, public provident funds (PPF), mutual funds, stocks (through reinvested dividends), and bonds are common examples where compound interest plays a role.</dd>

                <dt><strong>Q9: Is there a calculator to see how compound interest works?</strong></dt>
                <dd>A9: Yes, many online compound interest calculators are available. You typically input your initial principal, interest rate, compounding frequency, and investment duration to see the projected future value of your investment.</dd>

                <dt><strong>Q10: What's the best strategy for retirement using compound interest?</strong></dt>
                <dd>A10: The best strategy involves starting early, contributing regularly to tax-advantaged retirement accounts (like NPS or EPF in India), investing in a diversified portfolio of growth assets (like equity mutual funds), and being disciplined in reinvesting earnings.</dd>
            </dl>
        </div>
    </div>


    <script>
        // DOM Elements
        const currencySelect = document.getElementById('currency');
        const principalInput = document.getElementById('principal');
        const principalCurrencyLabel = document.getElementById('principalCurrencyLabel');
        const rateInput = document.getElementById('rate');
        const frequencyInput = document.getElementById('frequency');
        const timeInput = document.getElementById('time');
        const calculateBtn = document.getElementById('calculateBtn');
        const resetBtn = document.getElementById('resetBtn');
        const toggleBreakdownBtn = document.getElementById('toggleBreakdownBtn');
        const resultsDiv = document.getElementById('results');
        const resultPrincipalSpan = document.getElementById('resultPrincipal');
        const resultInterestLabel = document.getElementById('resultInterestLabel');
        const resultInterestSpan = document.getElementById('resultInterest');
        const resultTotalSpan = document.getElementById('resultTotal');
        const messageBox = document.getElementById('messageBox');
        const contributionTabsContainer = document.getElementById('contributionTabs');
        const contribNoneRadio = document.getElementById('contribNone');
        const depositFieldsSection = document.getElementById('depositFieldsSection');
        const depositAmountInput = document.getElementById('depositAmount');
        const depositFrequencySelect = document.getElementById('depositFrequency');
        const annualDepositIncreaseInput = document.getElementById('annualDepositIncrease');
        const resultTotalDepositsRow = document.getElementById('resultTotalDepositsRow');
        const resultTotalDepositsSpan = document.getElementById('resultTotalDeposits');
        const withdrawalFieldsSection = document.getElementById('withdrawalFieldsSection');
        const withdrawalAmountInput = document.getElementById('withdrawalAmount');
        const withdrawalFrequencySelect = document.getElementById('withdrawalFrequency');
        const annualWithdrawalIncreaseInput = document.getElementById('annualWithdrawalIncrease');
        const resultTotalWithdrawalsRow = document.getElementById('resultTotalWithdrawalsRow');
        const resultTotalWithdrawalsSpan = document.getElementById('resultTotalWithdrawals');
        const breakdownSection = document.getElementById('breakdownSection');
        const viewMonthlyBreakdownBtn = document.getElementById('viewMonthlyBreakdownBtn');
        const viewYearlyBreakdownBtn = document.getElementById('viewYearlyBreakdownBtn');
        const breakdownTableBody = document.getElementById('breakdownTableBody');

        // Sidebar and Educational Content Elements
        const hamburgerIcon = document.getElementById('hamburgerIcon');
        const sidebar = document.getElementById('sidebar');
        const closeBtn = document.getElementById('closeBtn');
        const sidebarLinks = document.querySelectorAll('#sidebar ul li');
        const educationalContentDiv = document.getElementById('educationalContent');
        const contentSections = document.querySelectorAll('.content-section');


        let detailedBreakdownData = [];
        let currentBreakdownView = 'monthly';

        // Event Listeners
        currencySelect.addEventListener('change', (event) => {
            principalCurrencyLabel.textContent = event.target.value;
            clearResultsAndMessages();
        });

        contributionTabsContainer.addEventListener('click', (event) => {
            if (event.target.tagName === 'LABEL') {
                const radioId = event.target.getAttribute('for');
                const radioInput = document.getElementById(radioId);
                if (radioInput) {
                    updateContributionSections(radioInput.value);
                }
            }
        });

        toggleBreakdownBtn.addEventListener('click', () => {
            const isHidden = breakdownSection.style.display === 'none' || breakdownSection.style.display === '';
            if (isHidden) {
                if (detailedBreakdownData.length > 0) {
                    breakdownSection.style.display = 'block';
                    toggleBreakdownBtn.textContent = 'Hide Breakdown';
                    renderBreakdownTable(currentBreakdownView);
                } else {
                    showMessage('Calculate first to see the breakdown.', 'info');
                }
            } else {
                breakdownSection.style.display = 'none';
                toggleBreakdownBtn.textContent = 'Show Breakdown';
            }
        });

        viewMonthlyBreakdownBtn.addEventListener('click', () => {
            currentBreakdownView = 'monthly';
            viewMonthlyBreakdownBtn.classList.add('active');
            viewYearlyBreakdownBtn.classList.remove('active');
            renderBreakdownTable(currentBreakdownView);
        });
        viewYearlyBreakdownBtn.addEventListener('click', () => {
            currentBreakdownView = 'yearly';
            viewYearlyBreakdownBtn.classList.add('active');
            viewMonthlyBreakdownBtn.classList.remove('active');
            renderBreakdownTable(currentBreakdownView);
        });

        resetBtn.addEventListener('click', resetCalculator);
        calculateBtn.addEventListener('click', performCalculation);

        const allInputs = [
            principalInput, rateInput, frequencyInput, timeInput,
            depositAmountInput, depositFrequencySelect, annualDepositIncreaseInput,
            withdrawalAmountInput, withdrawalFrequencySelect, annualWithdrawalIncreaseInput,
            currencySelect
        ];
        allInputs.forEach(input => {
            if (input) {
                input.addEventListener('input', clearResultsAndMessages);
                if (input.tagName === 'SELECT') { input.addEventListener('change', clearResultsAndMessages); }
            }
        });

        // Initial Setup - Wrapped in DOMContentLoaded for robustness
        document.addEventListener('DOMContentLoaded', () => {
            const initiallyCheckedRadio = document.querySelector('input[name="contributionType"]:checked');
            if (initiallyCheckedRadio) {
                updateContributionSections(initiallyCheckedRadio.value);
            } else {
                // Default to 'none' if no radio is checked initially (e.g., if 'checked' attribute is missing in HTML)
                updateContributionSections('none');
            }
            // Set initial currency label based on selected option in HTML (Indian Rupee is selected by default now)
            principalCurrencyLabel.textContent = currencySelect.options[currencySelect.selectedIndex].value;
        });


        // Sidebar Event Listeners
        hamburgerIcon.addEventListener('click', () => {
            // Toggle the 'open' class based on its current state
            if (sidebar.classList.contains('open')) {
                sidebar.classList.remove('open'); // Collapse sidebar
            } else {
                sidebar.classList.add('open'); // Open sidebar
            }
        });

        closeBtn.addEventListener('click', () => {
            sidebar.classList.remove('open');
        });

        sidebarLinks.forEach(link => {
            link.addEventListener('click', (event) => {
                const targetId = event.target.dataset.target;

                // Hide all content sections first
                contentSections.forEach(section => {
                    section.style.display = 'none';
                });

                // Show the target content section
                document.getElementById(targetId).style.display = 'block';

                // Close the sidebar
                sidebar.classList.remove('open');

                // Scroll to the educational content section
                educationalContentDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
            });
        });


        // Functions
        function updateContributionSections(type) {
            depositFieldsSection.style.display = (type === 'deposits' || type === 'both') ? 'block' : 'none';
            withdrawalFieldsSection.style.display = (type === 'withdrawals' || type === 'both') ? 'block' : 'none';

            // Reset specific fields when their section is hidden
            if (type !== 'deposits' && type !== 'both') {
                 depositAmountInput.value = '';
                 annualDepositIncreaseInput.value = '';
                 depositFrequencySelect.value = "12"; // Default
            }
            if (type !== 'withdrawals' && type !== 'both') {
                withdrawalAmountInput.value = '';
                annualWithdrawalIncreaseInput.value = '';
                withdrawalFrequencySelect.value = "12"; // Default
            }
            clearResultsAndMessages();
        }

        function resetCalculator() {
            principalInput.value = ''; rateInput.value = ''; timeInput.value = '';
            currencySelect.value = '₹'; // Set back to Indian Rupee as default
            principalCurrencyLabel.textContent = '₹';
            frequencyInput.value = '12';
            if (contribNoneRadio) { contribNoneRadio.checked = true; }
            updateContributionSections('none');

            detailedBreakdownData = [];
            breakdownSection.style.display = 'none';
            toggleBreakdownBtn.style.display = 'none';
            toggleBreakdownBtn.textContent = 'Show Breakdown';
            currentBreakdownView = 'monthly';
            viewMonthlyBreakdownBtn.classList.add('active');
            viewYearlyBreakdownBtn.classList.remove('active');
            showMessage('Calculator has been reset.', 'info');

            // Hide all educational content sections upon reset
            contentSections.forEach(section => {
                section.style.display = 'none';
            });
        }

        function performCalculation() {
            clearResultsAndMessages();
            detailedBreakdownData = [];

            const principal = parseFloat(principalInput.value);
            const annualRateDecimal = parseFloat(rateInput.value) / 100;
            const mainCompoundingFreqPerYear = parseInt(frequencyInput.value);
            const timeYears = parseFloat(timeInput.value);
            const selectedCurrency = currencySelect.value;
            const contributionChoice = document.querySelector('input[name="contributionType"]:checked').value;

            if (isNaN(principal) || principal < 0) { showMessage('Please enter a valid principal amount.', 'error'); principalInput.focus(); return; }
            if (isNaN(annualRateDecimal) || annualRateDecimal <= 0) { showMessage('Please enter a valid annual interest rate.', 'error'); rateInput.focus(); return; }
            if (isNaN(mainCompoundingFreqPerYear) || mainCompoundingFreqPerYear <= 0) { showMessage('Please select a valid main compounding frequency.', 'error'); return; }
            if (isNaN(timeYears) || timeYears <= 0) { showMessage('Please enter a valid time period in years.', 'error'); timeInput.focus(); return; }

            let futureValue = 0;
            let totalDepositsMade = 0;
            let totalWithdrawalsMade = 0;
            let totalInterestEarned = 0; // This will accumulate interest as per the reference's specific method

            if (contributionChoice === 'none') {
                const ratePerPeriod = annualRateDecimal / mainCompoundingFreqPerYear;
                const numPeriodsTotal = mainCompoundingFreqPerYear * timeYears;
                let currentLoopBalance = principal;

                for (let period = 1; period <= numPeriodsTotal; period++) {
                    const interestThisPeriod = currentLoopBalance * ratePerPeriod;
                    const startBal = currentLoopBalance;
                    currentLoopBalance += interestThisPeriod;

                    detailedBreakdownData.push({
                        periodType: 'Period',
                        periodNumber: period,
                        year: Math.ceil(period / mainCompoundingFreqPerYear),
                        startingBalance: startBal,
                        depositsThisPeriod: 0,
                        withdrawalsThisPeriod: 0,
                        interestEarnedThisPeriod: interestThisPeriod,
                        endingBalance: currentLoopBalance
                    });
                }
                futureValue = currentLoopBalance;
                totalInterestEarned = futureValue - principal;

            } else {
                let currentActualPeriodicDeposit = parseFloat(depositAmountInput.value) || 0;
                let depositFreqPeriodsPerYear = parseInt(depositFrequencySelect.value);
                let annualDepositIncreaseDecimal = (parseFloat(annualDepositIncreaseInput.value) || 0) / 100;

                let currentActualPeriodicWithdrawal = parseFloat(withdrawalAmountInput.value) || 0;
                let withdrawalFreqPeriodsPerYear = parseInt(withdrawalFrequencySelect.value);
                let annualWithdrawalIncreaseDecimal = (parseFloat(annualWithdrawalIncreaseInput.value) || 0) / 100;

                if ((contributionChoice === 'deposits' || contributionChoice === 'both') && (currentActualPeriodicDeposit < 0 || isNaN(depositFreqPeriodsPerYear) || depositFreqPeriodsPerYear <= 0 || annualDepositIncreaseDecimal < 0)) { showMessage('Invalid deposit inputs.', 'error'); return; }
                if ((contributionChoice === 'withdrawals' || contributionChoice === 'both') && (currentActualPeriodicWithdrawal < 0 || isNaN(withdrawalFreqPeriodsPerYear) || withdrawalFreqPeriodsPerYear <= 0 || annualWithdrawalIncreaseDecimal < 0)) { showMessage('Invalid withdrawal inputs.', 'error'); return; }

                // This will be the final "Future Value"
                let actualRunningBalance = principal;

                // This represents the "Balance" column in the reference breakdown table.
                // It tracks principal +/- cash flows, but NOT the interest itself.
                let balanceForBreakdownTable = principal;


                const totalMonthsToSimulate = Math.round(timeYears * 12);

                for (let month = 1; month <= totalMonthsToSimulate; month++) {
                    const startingBalanceForBreakdown = balanceForBreakdownTable; // This is the 'Balance' from the previous month's end in reference

                    let depositsThisMonthTotal = 0;
                    let withdrawalsThisMonthTotal = 0;

                    // Apply annual increase to periodic amounts
                    if (month > 1 && (month - 1) % 12 === 0) {
                        if (contributionChoice === 'deposits' || contributionChoice === 'both') { if(annualDepositIncreaseDecimal > 0) currentActualPeriodicDeposit *= (1 + annualDepositIncreaseDecimal); }
                        if (contributionChoice === 'withdrawals' || contributionChoice === 'both') { if(annualWithdrawalIncreaseDecimal > 0) currentActualPeriodicWithdrawal *= (1 + annualWithdrawalIncreaseDecimal); }
                    }

                    // Calculate deposits for the current month
                    if ((contributionChoice === 'deposits' || contributionChoice === 'both') && depositFreqPeriodsPerYear > 0 && currentActualPeriodicDeposit > 0) {
                        let depositOccurrencesInMonth = 0;
                        if (depositFreqPeriodsPerYear === 365) { // Daily
                            depositOccurrencesInMonth = (365 / 12);
                        } else if (depositFreqPeriodsPerYear === 52) { // Weekly
                            depositOccurrencesInMonth = (52 / 12);
                        } else { // Monthly, Quarterly, Semi-Annually, Annually
                            const depositIntervalMonths = 12 / depositFreqPeriodsPerYear;
                            if (month % depositIntervalMonths === 0) {
                                depositOccurrencesInMonth = 1;
                            }
                        }
                        depositsThisMonthTotal = currentActualPeriodicDeposit * depositOccurrencesInMonth;
                    }

                    // Calculate withdrawals for the current month
                    if ((contributionChoice === 'withdrawals' || contributionChoice === 'both') && withdrawalFreqPeriodsPerYear > 0 && currentActualPeriodicWithdrawal > 0) {
                        let withdrawalOccurrencesInMonth = 0;
                        if (withdrawalFreqPeriodsPerYear === 365) { // Daily
                            withdrawalOccurrencesInMonth = (365 / 12);
                        } else if (withdrawalFreqPeriodsPerYear === 52) { // Weekly
                            withdrawalOccurrencesInMonth = (52 / 12);
                        } else { // Monthly, Quarterly, Semi-Annually, Annually
                            const withdrawalIntervalMonths = 12 / withdrawalFreqPeriodsPerYear;
                            if (month % withdrawalIntervalMonths === 0) {
                                withdrawalOccurrencesInMonth = 1;
                            }
                        }
                        withdrawalsThisMonthTotal = currentActualPeriodicWithdrawal * withdrawalOccurrencesInMonth;
                    }

                    // --- ORDER OF OPERATIONS TO MATCH REFERENCE'S BREAKDOWN TABLE ---

                    // 1. Calculate interest for *this* month based on the 'balanceForBreakdownTable' from the start of the month (previous period's end balance)
                    let interestThisMonth = startingBalanceForBreakdown * (annualRateDecimal / 12);

                    // 2. Update the 'balanceForBreakdownTable' with current month's deposits and withdrawals
                    balanceForBreakdownTable = balanceForBreakdownTable + depositsThisMonthTotal - withdrawalsThisMonthTotal;

                    // 3. Update the 'actualRunningBalance' by applying deposits, withdrawals, and then the calculated interest
                    actualRunningBalance = actualRunningBalance + depositsThisMonthTotal - withdrawalsThisMonthTotal + interestThisMonth;

                    // Accumulate total deposits and withdrawals for summary
                    totalDepositsMade += depositsThisMonthTotal;
                    totalWithdrawalsMade += withdrawalsThisMonthTotal;

                    // Accumulate total interest earned (this should match the 'Accrued Interest' column in reference)
                    totalInterestEarned += interestThisMonth;

                    detailedBreakdownData.push({
                        periodType: 'Month',
                        periodNumber: month,
                        year: Math.ceil(month / 12),
                        startingBalance: startingBalanceForBreakdown, // This is the "Balance" from previous month in reference
                        depositsThisPeriod: depositsThisMonthTotal,
                        withdrawalsThisPeriod: withdrawalsThisMonthTotal,
                        interestEarnedThisPeriod: interestThisMonth,
                        endingBalance: balanceForBreakdownTable // This is the 'Balance' column value for current month in reference
                    });
                }
                futureValue = actualRunningBalance; // The final actual running balance
            }

            // Display Results
            const formatCurrency = (value, includeSign = false) => {
                const isNegative = value < 0;
                const absoluteValue = Math.abs(value);
                let formattedNumber;

                if (selectedCurrency === '¥' || selectedCurrency === '₩') {
                    formattedNumber = Math.round(absoluteValue).toLocaleString();
                } else {
                    formattedNumber = absoluteValue.toFixed(2);
                    // Ensure proper thousands separator for non-yen/won currencies
                    const parts = formattedNumber.split('.');
                    parts[0] = parseFloat(parts[0]).toLocaleString(undefined, {minimumFractionDigits: 0, maximumFractionDigits: 0});
                    formattedNumber = parts.join('.');
                }

                let finalString = `${selectedCurrency}${formattedNumber}`;

                // Only prepend '-' if value is truly negative and includeSign is true
                if (isNegative && includeSign) {
                    return `-${finalString}`;
                } else if (value === 0) {
                    return `${selectedCurrency}0.00`; // Always display 0.00 for zero
                }
                return finalString;
            };


            resultPrincipalSpan.textContent = formatCurrency(principal);

            resultTotalDepositsRow.style.display = (contributionChoice === 'deposits' || contributionChoice === 'both') && totalDepositsMade > 0 ? 'flex' : 'none';
            resultTotalDepositsSpan.textContent = formatCurrency(totalDepositsMade);

            resultTotalWithdrawalsRow.style.display = (contributionChoice === 'withdrawals' || contributionChoice === 'both') && totalWithdrawalsMade > 0 ? 'flex' : 'none';
            resultTotalWithdrawalsSpan.textContent = formatCurrency(totalWithdrawalsMade);
            // Withdrawals are always red if displayed and totalWithdrawalsMade is a positive value
            if (totalWithdrawalsMade > 0) { // Check the actual value, not just if the row is visible
                resultTotalWithdrawalsSpan.classList.add('negative');
            } else {
                resultTotalWithdrawalsSpan.classList.remove('negative');
            }


            // Handle Total Interest Earned/Lost label and color
            resultInterestSpan.classList.remove('light-positive', 'light-negative');

            // Always display "Total Interest Earned:" and let the value's sign indicate gain/loss
            resultInterestLabel.textContent = 'Total Interest Earned:';
            resultInterestSpan.textContent = formatCurrency(totalInterestEarned, true); // Always show sign for interest
            if (totalInterestEarned < 0) {
                resultInterestSpan.classList.add('light-negative');
            } else {
                resultInterestSpan.classList.add('light-positive');
            }


            // Handle Future Value (resultTotalSpan)
            resultTotalSpan.classList.remove('positive', 'negative');
            if (futureValue < 0) { // If strictly negative
                resultTotalSpan.textContent = formatCurrency(futureValue, true);
                resultTotalSpan.classList.add('negative');
            } else if (futureValue === 0 && principal > 0) { // If zero and started with principal > 0 (implies principal was depleted)
                resultTotalSpan.textContent = formatCurrency(futureValue, false); // Display as 0.00
                resultTotalSpan.classList.add('negative'); // Make it red as it's not a gain
            }
            else { // If positive
                resultTotalSpan.textContent = formatCurrency(futureValue, false);
                resultTotalSpan.classList.add('positive');
            }

            resultsDiv.style.display = 'block';
            toggleBreakdownBtn.style.display = 'block';
            showMessage('Calculation successful!', 'success');

            if (breakdownSection.style.display === 'block') {
                renderBreakdownTable(currentBreakdownView);
            }

            // Auto-scroll to the results section
            resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'end' });
        }

        function renderBreakdownTable(viewType) {
            breakdownTableBody.innerHTML = '';
            const dataToRender = [];
            const selectedCurrency = currencySelect.value;

            const formatCurrencyForTable = (value, includeSign = false) => {
                const isNegative = value < 0;
                const absoluteValue = Math.abs(value);
                let formattedNumber;

                if (selectedCurrency === '¥' || selectedCurrency === '₩') {
                    formattedNumber = Math.round(absoluteValue).toLocaleString();
                } else {
                    formattedNumber = absoluteValue.toFixed(2);
                    const parts = formattedNumber.split('.');
                    parts[0] = parseFloat(parts[0]).toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2});
                    formattedNumber = parts.join('.');
                }

                let finalString = `${selectedCurrency}${formattedNumber}`;

                if (isNegative && includeSign) {
                    return `-${finalString}`;
                } else if (value === 0) {
                    return `${selectedCurrency}0.00`;
                }
                return finalString;
            };

            if (viewType === 'yearly') {
                const years = {};
                detailedBreakdownData.forEach(itemData => {
                    const year = itemData.year;
                    if (!years[year]) {
                        years[year] = {
                            periodType: 'Year', periodNumber: year, year: year,
                            startingBalance: 0,
                            depositsThisPeriod: 0, withdrawalsThisPeriod: 0,
                            interestEarnedThisPeriod: 0, endingBalance: 0
                        };
                        // For yearly view, the starting balance of a year should be the ending balance of the previous year's last period,
                        // or the initial principal if it's the very first year.
                        // We need to find the balance at the end of the previous year or the start of the first month.
                        const lastBalanceOfPrevYear = detailedBreakdownData.findLast(d => d.year === year - 1);
                        if (lastBalanceOfPrevYear) {
                            years[year].startingBalance = lastBalanceOfPrevYear.endingBalance;
                        } else if (year === 1) {
                            years[year].startingBalance = parseFloat(principalInput.value);
                        }
                    }
                    years[year].depositsThisPeriod += itemData.depositsThisPeriod;
                    years[year].withdrawalsThisPeriod += itemData.withdrawalsThisPeriod;
                    years[year].interestEarnedThisPeriod += itemData.interestEarnedThisPeriod;
                    years[year].endingBalance = itemData.endingBalance; // The ending balance for the year is the ending balance of its last month
                });
                Object.values(years).forEach(yearData => dataToRender.push(yearData));

            } else { // Monthly or "Period" view from 'none' contribution
                detailedBreakdownData.forEach(itemData => dataToRender.push(itemData));
            }

            if (dataToRender.length === 0) {
                const row = breakdownTableBody.insertRow();
                const cell = row.insertCell();
                cell.colSpan = 6;
                cell.textContent = 'No breakdown data available. Please perform a calculation.';
                cell.style.textAlign = 'center';
                return;
            }

            dataToRender.forEach((item, index) => {
                const row = breakdownTableBody.insertRow();
                let periodDisplay = `${item.periodType} ${item.periodNumber}`;
                // For "Period" type when 'none' is selected, the periodNumber might be the compounding period index.
                // For "Month" type, it's the month number.
                // This display should be fine as is.

                row.insertCell().textContent = periodDisplay;
                row.insertCell().textContent = formatCurrencyForTable(item.startingBalance, false); // No sign for start balance

                const depositsCell = row.insertCell();
                depositsCell.textContent = formatCurrencyForTable(item.depositsThisPeriod, false); // Deposits are positive amounts
                if (item.depositsThisPeriod > 0) { depositsCell.classList.add('positive'); }

                const withdrawalsCell = row.insertCell();
                withdrawalsCell.textContent = formatCurrencyForTable(item.withdrawalsThisPeriod, false); // Withdrawals are positive amounts in data, but negative impact
                if (item.withdrawalsThisPeriod > 0) { withdrawalsCell.classList.add('negative'); }

                const interestCell = row.insertCell();
                interestCell.textContent = formatCurrencyForTable(item.interestEarnedThisPeriod, true); // Include sign for interest
                // Apply color based on actual interest earned for the period
                if (item.interestEarnedThisPeriod < 0) { interestCell.classList.add('light-negative'); }
                else if (item.interestEarnedThisPeriod > 0) { interestCell.classList.add('light-positive'); }


                const endBalanceCell = row.insertCell();
                endBalanceCell.textContent = formatCurrencyForTable(item.endingBalance, true); // Include sign for end balance
                endBalanceCell.classList.remove('positive', 'negative'); // Clear existing classes
                if (item.endingBalance < 0) {
                    endBalanceCell.classList.add('negative');
                } else if (item.endingBalance === 0 && principal > 0) { // If zero and principal was positive
                    endBalanceCell.classList.add('negative');
                }
                else {
                    endBalanceCell.classList.add('positive');
                }
            });
        }

        function showMessage(message, type) {
            messageBox.textContent = message; messageBox.style.display = 'block';
            messageBox.className = 'message-box';
            if (type === 'error') { messageBox.classList.add('message-box-error'); }
            else if (type === 'success') { messageBox.classList.add('message-box-success'); }
            else if (type === 'info') { messageBox.classList.remove('message-box-error', 'message-box-success'); }
        }

        function clearResultsAndMessages() {
            resultsDiv.style.display = 'none';
            messageBox.style.display = 'none';
            messageBox.textContent = ''; messageBox.className = 'message-box';
            resultTotalDepositsRow.style.display = 'none';
            resultTotalWithdrawalsRow.style.display = 'none';
            resultTotalSpan.classList.remove('positive', 'negative');
            resultInterestSpan.classList.remove('light-positive', 'light-negative');
            resultTotalWithdrawalsSpan.classList.remove('negative'); // Clear color from withdrawals
            resultInterestLabel.textContent = 'Total Interest Earned:'; // Reset label

            toggleBreakdownBtn.style.display = 'none';
            if (breakdownSection.style.display !== 'none') {
                 breakdownSection.style.display = 'none';
                 toggleBreakdownBtn.textContent = 'Show Breakdown';
            }
        }
    </script>
</body>
</html>
